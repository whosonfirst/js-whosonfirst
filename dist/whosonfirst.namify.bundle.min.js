var whosonfirst=whosonfirst||{};whosonfirst.php=function(){var e={htmlspecialchars:function(e,t,n,s){var i,a=0,o=0,r=!1;if((typeof t=="undefined"||t===null)&&(t=2),e=e.toString(),s!==!1&&(e=e.replace(/&/g,"&amp;")),e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;"),i={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4},t===0&&(r=!0),typeof t!="number"){t=[].concat(t);for(o=0;o<t.length;o++)i[t[o]]===0?r=!0:i[t[o]]&&(a=a|i[t[o]]);t=a}return t&i.ENT_HTML_QUOTE_SINGLE&&(e=e.replace(/'/g,"&#039;")),r||(e=e.replace(/"/g,"&quot;")),e}};return e}(),whosonfirst=whosonfirst||{},whosonfirst.log=function(){var t=[],e={show:function(){e.toggle(!0)},hide:function(){e.toggle(!1)},toggle:function(e){var n,t=document.getElementById("wof-log-container");if(!t)return!1;n=e?"display:block":"display:none",t.setAttribute("style",n)},debug:function(t){e.dispatch(t,"debug")},info:function(t){e.dispatch(t,"info")},warning:function(t){e.dispatch(t,"warning")},error:function(t){e.dispatch(t,"error")},log:function(t,n){return e.dispatch(t,n)},dispatch:function(n,s){var i,o=new Date;t.push([s,n,o]),i=e._render(n,s,o),e._attach(i),e.show()},_render:function(e,t,n){var s,i,a,r,c=mapzen.whosonfirst.php.htmlspecialchars(e),l=mapzen.whosonfirst.php.htmlspecialchars(t),o=document.createElement("li");return o.setAttribute("class","wof-log-item wof-log-"+l),r=document.createTextNode(c),i=document.createElement("span"),i.setAttribute("class","wof-log-body"),i.appendChild(r),s=n.toISOString(),s=mapzen.whosonfirst.php.htmlspecialchars(s),s=document.createTextNode(s+" "+t),a=document.createElement("code"),a.setAttribute("class","wof-log-ts"),a.appendChild(s),o.appendChild(a),o.appendChild(i),o},_attach:function(e){var t=document.getElementById("wof-log");return t?(t.insertBefore(e,t.childNodes[0]),!0):(console.log("faile to locate #wof-log container"),!1)}};return e}(),whosonfirst=whosonfirst||{},whosonfirst.net=function(){var t=3e4,e={encode_query:function(e){enc=new Array;for(n in e){var n,t=e[n],t=encodeURIComponent(t);enc.push(n+"="+t)}return enc.join("&")},fetch:function(n,s,o,i){if(typeof i=="undefined"?i={}:typeof i=="number"&&(i={cache_ttl:i}),i.cache_ttl)var r,c,a=i.cache_ttl;else a=t;r=function(t){e.log("debug","[cached] fetch "+n),s&&s(t)},c=function(){e.fetch_with_xhr(n,s,o,i)},e.cache_get(n,r,c,a)||e.fetch_with_xhr(n,s,o,i)},fetch_with_xhr:function(t,n,s,o){e.log("debug","[xhr] fetch "+t),o||(o={});var i,r,a=new XMLHttpRequest;a.onload=function(){try{var o=JSON.parse(this.responseText)}catch(n){return e.log("error","failed to parse "+t+", because "+n),s&&s(),!1}e.cache_set(t,o),n&&n(o)};try{o["cache-busting"]&&(r=Math.floor(Math.random()*1e6),i=document.createElement("a"),i.href=t,i.search?i.search+="&cb="+r:i.search="?cb= "+r,t=i.href),a.open("get",t,!0),a.send()}catch(n){e.log("error","failed to fetch "+t+", because "),e.log("debug",n),s&&s()}},cache_get:function(t,n,s,o){if(typeof localforage!="object")return!1;var i=e.cache_prep_key(t);return localforage.getItem(i,function(i,a){if(i||!a){s();return}var c,l,d,u,r=a.data;if(!r){s();return}if(c=new Date,l=c.getTime(),d=a.created,u=l-d,u>o){e.cache_unset(t),s();return}n(r)}),!0},cache_set:function(t,n){if(typeof localforage!="object")return!1;var s=new Date,o=s.getTime(),i={data:n,created:o};return t=e.cache_prep_key(t),localforage.setItem(t,i),!0},cache_unset:function(t){return typeof localforage=="object"&&(t=e.cache_prep_key(t),localforage.removeItem(t),!0)},cache_prep_key:function(e){return e+"#whosonfirst.net"},log:function(e,t){if(typeof whosonfirst.log!="object"){console.log(e,t);return}whosonfirst.log.dispatch(t,e)}};return e}(),whosonfirst=whosonfirst||{},whosonfirst.uri=function(){var t="https://data.whosonfirst.org/",e={endpoint:function(n){return n&&(e.log("info","set uri endpoint to "+n),t=n),t},id2abspath:function(t,n){var s=e.id2relpath(t,n),o=e.endpoint()+s;return o},id2relpath:function(t,n){parent=e.id2parent(t),fname=e.id2fname(t,n);var s=parent+"/"+fname;return s},id2parent:function(e){for(str_id=new String(e),tmp=new Array;str_id.length;){var t=str_id.substr(0,3);tmp.push(t),str_id=str_id.substr(3)}return parent=tmp.join("/"),parent},id2fname:function(e,t){t||(t={});var s,o,i,a,r,c,l,n=[encodeURIComponent(e)];if(t.alt)if(n.push("alt"),t.source){if(i=encodeURIComponent(t.source),n.push(i),t.function&&(a=encodeURIComponent(t.function),n.push(a),t.extras&&t.extras.join))for(o=t.extras,r=o.length,s=0;s<r;s++)c=encodeURIComponent(o[s]),n.push(c)}else console.log("missing source parameter for alternate geometry"),n.push("unknown");return l=n.join("-"),l+".geojson"},log:function(e,t){if(typeof whosonfirst.log!="object"){console.log(e,t);return}whosonfirst.log.dispatch(t,e)}};return e}(),whosonfirst=whosonfirst||{},whosonfirst.html=whosonfirst.html||{},whosonfirst.html.namify=function(){var t=3e4,e={init:function(){},namify_wof:function(){for(var s=whosonfirst.uri.id2abspath,n=document.getElementsByClassName("wof-namify"),o=n.length,t=0;t<o;t++)e.namify_el(n[t],s)},namify_brands:function(){for(var s=whosonfirst.brands.id2abspath,n=document.getElementsByClassName("wof-namify-brand"),o=n.length,t=0;t<o;t++)e.namify_el(n[t],s)},namify_el:function(t,n){var s,i,a,o=t.getAttribute("data-wof-id");if(!o){e.log("info","node is missing data-wof-id attribute");return}if(t.textContent!=o){e.log("info","node has not-a-wof-id body");return}s=n(o),i=function(n){e.apply_namification(t,n)},a=function(){e.namify_el_from_source(s,t)},e.cache_get(s,i,a)||e.namify_el_from_source(s,t)},namify_el_from_source:function(t,n){var s=function(s){e.apply_namification(n,s),e.cache_set(t,s)},o=function(){};whosonfirst.net.fetch(t,s,o)},apply_namification:function(e,t){var n,o,s=t.properties;s||(s=t),n=s["wof:label"],(!n||n=="")&&(n=s["wof:name"]),o=whosonfirst.php.htmlspecialchars(n),e.innerHTML=o},cache_get:function(n,s,o){if(typeof localforage!="object")return!1;var i=e.cache_prep_key(n);return localforage.getItem(i,function(i,a){(i||!a)&&o();var c,l,d,u,r=a.data;r||o(),c=new Date,l=c.getTime(),d=a.created,u=l-d,u>t&&(e.cache_unset(n),o()),s(r)}),!0},cache_set:function(t,n){if(typeof localforage!="object")return!1;var s=new Date,o=s.getTime(),i={data:n,created:o};return t=e.cache_prep_key(t),localforage.setItem(t,i),!0},cache_unset:function(t){return typeof localforage=="object"&&(t=e.cache_prep_key(t),localforage.removeItem(t),!0)},cache_prep_key:function(e){return e+"#namify"},log:function(e,t){if(typeof whosonfirst.log!=object){console.log(e,t);return}whosonfirst.log.dispatch(t,e)}};return e}()